{% extends 'student/studentbase.html' %}
{% block content %}
{% load static %}

<head>
  <!-- âœ… Modern Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      font-family: 'Poppins', sans-serif;
    }
    .quiz-container {
      max-width: 750px;
      margin: 50px auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      overflow: hidden;
      animation: fadeIn 0.8s ease;
    }
    .quiz-header {
      background: #0d6efd;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .question-card {
      padding: 30px;
      display: none;
      animation: fadeIn 0.5s ease;
    }
    .question-card.active {
      display: block;
    }
    .form-check {
      background: #f9f9f9;
      margin: 8px 0;
      padding: 10px 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    .form-check:hover {
      background: #e8f0fe;
      transform: translateX(3px);
    }
    .quiz-footer {
      text-align: center;
      padding: 20px;
      border-top: 1px solid #eee;
      background-color: #fafafa;
    }
    .btn-custom {
      border-radius: 50px;
      padding: 10px 25px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<div class="quiz-container">
  <div class="quiz-header">
    <h2>{{ course.course_name }}</h2>
    <div class="progress mt-3" style="height: 8px;">
      <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
        style="width: 0%;"></div>
    </div>
  </div>

  <form id="quizForm" class="form" autocomplete="off" onsubmit="return saveAns()" action="/student/calculate-marks" method="POST">
    {% csrf_token %}
    {% for q in questions %}
    <div class="question-card {% if forloop.first %}active{% endif %}" id="question{{ forloop.counter }}">
      <h4 class="text-primary fw-bold">{{ forloop.counter }}. {{ q.question }}</h4>
      <p class="text-end text-muted">[{{ q.marks }} Marks]</p>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="opt1{{ forloop.counter }}" value="Option1">
        <label class="form-check-label" for="opt1{{ forloop.counter }}">{{ q.option1 }}</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="opt2{{ forloop.counter }}" value="Option2">
        <label class="form-check-label" for="opt2{{ forloop.counter }}">{{ q.option2 }}</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="opt3{{ forloop.counter }}" value="Option3">
        <label class="form-check-label" for="opt3{{ forloop.counter }}">{{ q.option3 }}</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="opt4{{ forloop.counter }}" value="Option4">
        <label class="form-check-label" for="opt4{{ forloop.counter }}">{{ q.option4 }}</label>
      </div>

      <div class="quiz-footer mt-4">
        {% if not forloop.first %}
        <button type="button" class="btn btn-outline-secondary btn-custom" onclick="prevQuestion({{ forloop.counter }})">Previous</button>
        {% endif %}
        {% if not forloop.last %}
        <button type="button" class="btn btn-primary btn-custom" onclick="nextQuestion({{ forloop.counter }})">Next</button>
        {% else %}
        <button type="submit" class="btn btn-success btn-custom">Submit Answers</button>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </form>
</div>

<script>
let totalQuestions = {{ questions|length }};
let current = 1;

function updateProgress() {
  let percent = ((current - 1) / totalQuestions) * 100;
  document.getElementById('progressBar').style.width = percent + '%';
}

function nextQuestion(currentQ) {
  document.getElementById('question' + currentQ).classList.remove('active');
  document.getElementById('question' + (currentQ + 1)).classList.add('active');
  current++;
  updateProgress();
}

function prevQuestion(currentQ) {
  document.getElementById('question' + currentQ).classList.remove('active');
  document.getElementById('question' + (currentQ - 1)).classList.add('active');
  current--;
  updateProgress();
}

function saveAns() {
  let inputs = document.getElementsByTagName('input'); 
  for (let i = 0; i < inputs.length; i++) { 
    if (inputs[i].type === "radio" && inputs[i].checked) {        
      setCookie(inputs[i].name, inputs[i].value, 3);
    }
  }
  document.getElementById('progressBar').style.width = '100%';
  return true;
}

function setCookie(cname, cvalue, exdays) {
  let d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

updateProgress();
</script>

{% endblock content %}
