{% extends 'student/studentbase.html' %}
{% block content %}
{% load static %}

<head>
  <!-- Modern Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      font-family: 'Poppins', sans-serif;
    }
    .results-container {
      max-width: 900px;
      margin: 50px auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      padding: 30px;
    }
    .panel-title {
      font-weight: 600;
      color: #007bff;
    }
    .question-card {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 2px solid transparent;
      transition: 0.3s;
    }
    .question-card.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }
    .question-card.wrong {
      border-color: #f44336;
      background: #ffebee;
    }
    .question-text {
      font-weight: 600;
      font-size: 17px;
      color: #333;
    }
    .option {
      padding: 8px 12px;
      border-radius: 8px;
      margin-top: 5px;
    }
    .correct-answer {
      background: #c8e6c9;
      font-weight: 500;
    }
    .wrong-answer {
      background: #ffcdd2;
    }
    .earned {
      color: #2e7d32;
      font-weight: 600;
    }
    .lost {
      color: #c62828;
      font-weight: 600;
    }
  </style>
</head>

<div class="results-container">
  <div class="text-center mb-4">
    <h3 class="panel-title">My Exam Performance</h3>
    <hr>
  </div>

  <!-- Summary Table -->
  <div class="table-responsive mb-5">
    <table class="table table-striped table-bordered">
      <thead class="table-primary">
        <tr>
          <th>Course</th>
          <th>Total Marks</th>
          <th>Number of Attempts</th>
          <th>Exam Date</th>
        </tr>
      </thead>
      <tbody>
        {% for t in results %}
        <tr>
          <td>{{ t.exam }}</td>
          <td>{{ t.marks }} / {{ total_marks }}</td>
          <td>Attempt {{ forloop.counter }}</td>
          <td>{{ t.date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Detailed Question Review -->
  <h5 class="text-primary mb-3">Detailed Question Review</h5>

  {% for q in questions %}
  <div class="question-card {% if q.is_correct %}correct{% else %}wrong{% endif %}">
    <div class="question-text">
      Q{{ forloop.counter }}. {{ q.question }}
      {% if q.is_correct %}
      <span class="text-success float-end"><i class="bi bi-check-circle-fill"></i> Correct</span>
      {% else %}
      <span class="text-danger float-end"><i class="bi bi-x-circle-fill"></i> Wrong</span>
      {% endif %}
    </div>
    <hr>

    <div>
      <p><strong>Your Answer:</strong>
        <span class="{% if q.is_correct %}text-success{% else %}text-danger{% endif %}">
          {{ q.selected_option|default:"Not Answered" }}
        </span>
      </p>

      <p><strong>Correct Answer:</strong> 
        <span class="text-success">{{ q.correct_option }}</span>
      </p>

      <p><strong>Marks:</strong>
        {% if q.is_correct %}
          <span class="earned">+{{ q.marks }}</span>
        {% else %}
          <span class="lost">0</span>
        {% endif %}
      </p>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock content %}
